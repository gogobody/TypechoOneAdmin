(function(){var q=[].slice;var E=function(){function h(){this.commonWhiteList="kbd|b|i|strong|em|sup|sub|br|code|del|a|hr|small";this.blockHtmlTags="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend|article|section|nav|aside|hgroup|header|footer|figcaption|svg|script|noscript";this.specialWhiteList={table:"table|tbody|thead|tfoot|tr|td|th"};this.hooks={};this.line=this.html=!1;this.blockParsers=[["code",10],["shtml",20],["pre",30],["ahtml",40],["list",50],["math",60],
["html",70],["footnote",80],["definition",90],["quote",100],["table",110],["sh",120],["mh",130],["hr",140],["default",9999]];this.parsers={}}var z=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var C=function(a){return a.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};var y=function(a,b,c){var d,e;if(a instanceof Array)if(b instanceof Array){var f=d=0;for(e=a.length;d<e;f=++d){var g=a[f];c=y(g,b[f],c)}}else for(f=0,d=a.length;f<d;f++)g=a[f],c=y(g,b,c);else a=C(a),c=c.replace(new RegExp(a,
"g"),b.replace(/\$/g,"$$$$"));return c};var u=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var v=function(a,b){var c,d;null==b&&(b=null);if(null!=b){var e="";var f=c=0;for(d=b.length-1;0<=d?c<=d:c>=d;f=0<=d?++c:--c)f=b[f],f=C(f),e+=f;e="["+e+"]*";return a.replace(new RegExp("^"+e),"").replace(new RegExp(e+"$"),"")}return a.replace(/^\s*/,"").replace(/\s*$/,"")};var D=function(a){var b;var c=[];if(a instanceof Array){var d=b=0;for(a=a.length;b<
a;d=++b)c.push(d)}else for(d in a)c.push(d);return c};var F=function(a){var b;var c=[];if(a instanceof Array){var d=0;for(b=a.length;d<b;d++){var e=a[d];c.push(e)}}else for(d in a)e=a[d],c.push(e);return c};h.prototype.makeHtml=function(a){var b;this.footnotes=[];this.definitions={};this.holders={};this.uniqid=Math.ceil(1E7*Math.random())+Math.ceil(1E7*Math.random());this.id=0;this.blockParsers.sort(function(g,k){return g[1]<k[1]?-1:1});var c=this.blockParsers;var d=0;for(b=c.length;d<b;d++){var e=
c[d];var f=e[0];this.parsers[f]=void 0!==e[2]?e[2]:this["parseBlock"+z(f)].bind(this)}a=this.initText(a);a=this.parse(a);a=this.makeFootnotes(a);a=this.optimizeLines(a);return this.call("makeHtml",a)};h.prototype.enableHtml=function(a){this.html=null!=a?a:!0};h.prototype.enableLine=function(a){this.line=null!=a?a:!0};h.prototype.hook=function(a,b){null==this.hooks[a]&&(this.hooks[a]=[]);return this.hooks[a].push(b)};h.prototype.makeHolder=function(a){var b="|\r"+this.uniqid+this.id+"\r|";this.id+=
1;this.holders[b]=a;return b};h.prototype.initText=function(a){return a.replace(/\t/g,"    ").replace(/\r/g,"")};h.prototype.makeFootnotes=function(a){var b,c;if(0<this.footnotes.length){a+='<div class="footnotes"><hr><ol>';for(b=1;c=this.footnotes.shift();)"string"===typeof c?c+=' <a href="#fnref-'+b+'" class="footnote-backref">&#8617;</a>':(c[c.length-1]+=' <a href="#fnref-'+b+'" class="footnote-backref">&#8617;</a>',c=1<c.length?this.parse(c.join("\n")):this.parseInline(c[0])),a+='<li id="fn-'+
b+'">'+c+"</li>",b+=1;a+="</ol></div>"}return a};h.prototype.parse=function(a,b,c){var d;null==b&&(b=!1);null==c&&(c=0);var e=[];a=this.parseBlock(a,e);var f="";b&&1===a.length&&"normal"===a[0][0]&&(a[0][3]=!0);b=0;for(d=a.length;b<d;b++){var g=a[b];var k=g[0];var l=g[1];var n=g[2];g=g[3];var r=e.slice(l,n+1);k="parse"+z(k);r=this.call("before"+z(k),r,g);n=this[k](r,g,l+c,n+c);n=this.call("after"+z(k),n,g);f+=n}return f};h.prototype.call=function(){var a;var b=arguments[0];var c=2<=arguments.length?
q.call(arguments,1):[];var d=c[0];if(null==this.hooks[b])return d;var e=this.hooks[b];b=0;for(a=e.length;b<a;b++)d=e[b],d=d.apply(this,c),c[0]=d;return d};h.prototype.releaseHolder=function(a,b){var c;null==b&&(b=!0);for(c=0;0<=a.indexOf("\r")&&10>c;)a=y(D(this.holders),F(this.holders),a),c+=1;b&&(this.holders={});return a};h.prototype.markLine=function(a,b){null==b&&(b=-1);return this.line?'<span class="line" data-start="'+a+'" data-end="'+(0>b?a:b)+'" data-id="'+this.uniqid+'"></span>':""};h.prototype.markLines=
function(a,b){var c=-1;return this.line?a.map(function(d){return function(e){c+=1;return d.markLine(b+c)+e}}(this)):a};h.prototype.optimizeLines=function(a){var b=0;var c=new RegExp('class="line" data\\-start="([0-9]+)" data\\-end="([0-9]+)" (data\\-id="'+this.uniqid+'")',"g");return this.line?a.replace(c,function(){var d=1<=arguments.length?q.call(arguments,0):[];var e=b!==parseInt(d[1])?'class="line" data-start="'+b+'" data-start-original="'+d[1]+'" data-end="'+d[2]+'" '+d[3]:d[0];b=1+parseInt(d[2]);
return e}):a};h.prototype.parseInline=function(a,b,c,d){null==b&&(b="");null==c&&(c=!0);null==d&&(d=!0);a=this.call("beforeParseInline",a);a=a.replace(/(^|[^\\])(`+)(.+?)\2/mg,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];return f[1]+e.makeHolder("<code>"+u(f[3])+"</code>")}}(this));a=a.replace(/(^|[^\\])(\$+)(.+?)\2/mg,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];return f[1]+e.makeHolder(f[2]+u(f[3])+f[2])}}(this));a=a.replace(/\\(.)/g,
function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];f=u(f[1]);f=f.replace(/\$/g,"&dollar;");return e.makeHolder(f)}}(this));a=a.replace(/<(https?:\/\/.+)>/ig,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=e.cleanUrl(f[1]);f=e.call("parseLink",f[1]);return e.makeHolder('<a href="'+g+'">'+f+"</a>")}}(this));a=a.replace(/<(\/?)([a-z0-9-]+)(\s+[^>]*)?>/ig,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];return e.html||
0<=("|"+e.commonWhiteList+"|"+b+"|").indexOf("|"+f[2].toLowerCase()+"|")?e.makeHolder(f[0]):u(f[0])}}(this));this.html&&(a=a.replace(/<!\-\-(.*?)\-\->/g,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];return e.makeHolder(f[0])}}(this)));a=y(["<",">"],["&lt;","&gt;"],a);a=a.replace(/\[\^((?:[^\]]|\\\]|\\\[)+?)\]/g,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=e.footnotes.indexOf(f[1]);0>g&&(g=e.footnotes.length+1,e.footnotes.push(e.parseInline(f[1],
"",!1)));return e.makeHolder('<sup id="fnref-'+g+'"><a href="#fn-'+g+'" class="footnote-ref">'+g+"</a></sup>")}}(this));a=a.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=u(e.escapeBracket(f[1]));f=e.escapeBracket(f[2]);f=e.cleanUrl(f);return e.makeHolder('<img src="'+f+'" alt="'+g+'" title="'+g+'">')}}(this));a=a.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,function(e){return function(){var f=
1<=arguments.length?q.call(arguments,0):[];var g=u(e.escapeBracket(f[1]));return e.makeHolder(null!=e.definitions[f[2]]?'<img src="'+e.definitions[f[2]]+'" alt="'+g+'" title="'+g+'">':g)}}(this));a=a.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=e.parseInline(e.escapeBracket(f[1]),"",!1,!1);f=e.escapeBracket(f[2]);f=e.cleanUrl(f);return e.makeHolder('<a href="'+f+'">'+g+"</a>")}}(this));a=a.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,
function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=e.parseInline(e.escapeBracket(f[1]),"",!1,!1);return e.makeHolder(null!=e.definitions[f[2]]?'<a href="'+e.definitions[f[2]]+'">'+g+"</a>":g)}}(this));a=this.parseInlineCallback(a);a=a.replace(/<([_a-z0-9-\.\+]+@[^@]+\.[a-z]{2,})>/ig,'<a href="mailto:$1">$1</a>');d&&(d=/(^|[^"])((https?):[A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005\u3006\u3031-\u3035\u303b\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6e5\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc_0-9-\./%#!@\?\+=~\|\,&\(\)]+)($|[^"])/ig,
a=a.replace(d,function(e){return function(){var f=1<=arguments.length?q.call(arguments,0):[];var g=e.call("parseLink",f[2]);return f[1]+'<a href="'+f[2]+'">'+g+"</a>"+f[4]}}(this)));a=this.call("afterParseInlineBeforeRelease",a);a=this.releaseHolder(a,c);return a=this.call("afterParseInline",a)};h.prototype.parseInlineCallback=function(a){a=a.replace(/(\*{3})((?:.|\r)+?)\1/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return"<strong><em>"+b.parseInlineCallback(c[2])+
"</em></strong>"}}(this));a=a.replace(/(\*{2})((?:.|\r)+?)\1/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return"<strong>"+b.parseInlineCallback(c[2])+"</strong>"}}(this));a=a.replace(/(\*)((?:.|\r)+?)\1/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return"<em>"+b.parseInlineCallback(c[2])+"</em>"}}(this));a=a.replace(/(\s+|^)(_{3})((?:.|\r)+?)\2(\s+|$)/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,
0):[];return c[1]+"<strong><em>"+b.parseInlineCallback(c[3])+"</em></strong>"+c[4]}}(this));a=a.replace(/(\s+|^)(_{2})((?:.|\r)+?)\2(\s+|$)/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return c[1]+"<strong>"+b.parseInlineCallback(c[3])+"</strong>"+c[4]}}(this));a=a.replace(/(\s+|^)(_)((?:.|\r)+?)\2(\s+|$)/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return c[1]+"<em>"+b.parseInlineCallback(c[3])+"</em>"+c[4]}}(this));return a=
a.replace(/(~{2})((?:.|\r)+?)\1/mg,function(b){return function(){var c=1<=arguments.length?q.call(arguments,0):[];return"<del>"+b.parseInlineCallback(c[2])+"</del>"}}(this))};h.prototype.parseBlock=function(a,b){var c,d,e;var f=a.split("\n");var g=0;for(c=f.length;g<c;g++)a=f[g],b.push(a);this.blocks=[];this.current="normal";this.pos=-1;var k={special:D(this.specialWhiteList).join("|"),empty:0,html:!1};c=f=0;for(d=b.length;f<d;c=++f){a=b[c];g=this.getBlock();null!=g&&(g=g.slice(0));if("normal"!==
this.current){var l=this.parsers[this.current](g,c,a,k,b);if(!l)continue}var n=this.parsers;for(e in n)if(l=n[e],e!==this.current&&(l=l(g,c,a,k,b),!l))break}return this.optimizeBlocks(this.blocks,b)};h.prototype.parseBlockList=function(a,b,c,d){var e;if(e=c.match(/^(\s*)((?:[0-9]+\.)|\-|\+|\*)\s+/i))return a=e[1].length,d.empty=0,this.isBlock("list")?this.setBlock(b,a):this.startBlock("list",b,a),!1;if(this.isBlock("list")&&!c.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/)){if(1>=d.empty&&(e=c.match(/^(\s+)/))&&
e[1].length>a[3])return d.empty=0,this.setBlock(b),!1;if(c.match(/^\s*$/)&&0===d.empty)return d.empty+=1,this.setBlock(b),!1}return!0};h.prototype.parseBlockCode=function(a,b,c){var d;return(c=c.match(/^(\s*)(~{3,}|`{3,})([^`~]*)$/i))?(this.isBlock("code")?(d=a[3][2])?this.combineBlock().setBlock(b):this.setBlock(b).endBlock():(d=!1,this.isBlock("list")&&(a=a[3],d=0<a&&c[1].length>=a||c[1].length>a),this.startBlock("code",b,[c[1],c[3],d])),!1):this.isBlock("code")?(this.setBlock(b),!1):!0};h.prototype.parseBlockShtml=
function(a,b,c,d){if(this.html){if(c.match(/^(\s*)!!!(\s*)$/))return this.isBlock("shtml")?this.setBlock(b).endBlock():this.startBlock("shtml",b),!1;if(this.isBlock("shtml"))return this.setBlock(b),!1}return!0};h.prototype.parseBlockAhtml=function(a,b,c,d){if(this.html)if(a=new RegExp("^\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","i"),a=c.match(a)){if(this.isBlock("ahtml"))return this.setBlock(b),!1;if(void 0===a[2]||"/"!==a[2]){this.startBlock("ahtml",b);for(b=new RegExp("\\s*<("+this.blockHtmlTags+
")(\\s+[^>]*)?>","ig");;){a=b.exec(c);if(!a)break;var e=a[1]}0<=c.indexOf("</"+e+">")?this.endBlock():d.html=e;return!1}}else{if(d.html&&0<=c.indexOf("</"+d.html+">"))return this.setBlock(b).endBlock(),d.html=!1;if(this.isBlock("ahtml"))return this.setBlock(b),!1;if(c.match(/^\s*<!\-\-(.*?)\-\->\s*$/))return this.startBlock("ahtml",b).endBlock(),!1}return!0};h.prototype.parseBlockMath=function(a,b,c){return c.match(/^(\s*)\$\$(\s*)$/)?(this.isBlock("math")?this.setBlock(b).endBlock():this.startBlock("math",
b),!1):this.isBlock("math")?(this.setBlock(b),!1):!0};h.prototype.parseBlockPre=function(a,b,c,d){return c.match(/^ {4}/)?(this.isBlock("pre")?this.setBlock(b):this.startBlock("pre",b),!1):this.isBlock("pre")&&c.match(/^\s*$/)?(this.setBlock(b),!1):!0};h.prototype.parseBlockHtml=function(a,b,c,d){return(a=c.match(new RegExp("^\\s*<("+d.special+")(\\s+[^>]*)?>","i")))?(c=a[1].toLowerCase(),this.isBlock("html",c)||this.isBlock("pre")||this.startBlock("html",b,c),!1):(a=c.match(new RegExp("</("+d.special+
")>\\s*$","i")))?(c=a[1].toLowerCase(),this.isBlock("html",c)&&this.setBlock(b).endBlock(),!1):this.isBlock("html")?(this.setBlock(b),!1):!0};h.prototype.parseBlockFootnote=function(a,b,c){return(a=c.match(/^\[\^((?:[^\]]|\\\]|\\\[)+?)\]:/))?(c=a[0].length-1,this.startBlock("footnote",b,[c,a[1]]),!1):!0};h.prototype.parseBlockDefinition=function(a,b,c){return(a=c.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/))?(this.definitions[a[1]]=this.cleanUrl(a[2]),this.startBlock("definition",b).endBlock(),
!1):!0};h.prototype.parseBlockQuote=function(a,b,c){return(a=c.match(/^(\s*)>/))?(this.isBlock("list")&&0<a[1].length?this.setBlock(b):this.isBlock("quote")?this.setBlock(b):this.startBlock("quote",b),!1):!0};h.prototype.parseBlockTable=function(a,b,c,d,e){var f;if(d=c.match(/^((?:(?:(?:\||\+)(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:[ :]*\-+[ :]*)(?:\||\+)(?:[ :]*\-+[ :]*))|(?:(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:\||\+)(?:[ :]*\-+[ :]*)))+)$/)){if(this.isBlock("table"))a[3][0].push(a[3][2]),a[3][2]+=1,this.setBlock(b,
a[3]);else{c=0;null==a||"normal"!==a[0]||e[a[2]].match(/^\s*$/)?this.startBlock("table",b):(c=1,this.backBlock(1,"table"));"|"===d[1][0]&&(d[1]=d[1].substring(1),"|"===d[1][d[1].length-1]&&(d[1]=d[1].substring(0,d[1].length-1)));var g=d[1].split(/\+|\|/);e=[];var k=0;for(f=g.length;k<f;k++){d=g[k];a="none";if(d=d.match(/^\s*(:?)\-+(:?)\s*$/))d[1]&&d[2]?a="center":d[1]?a="left":d[2]&&(a="right");e.push(a)}this.setBlock(b,[[c],e,c+1])}return!1}return!0};h.prototype.parseBlockSh=function(a,b,c){return(a=
c.match(/^(#+)(.*)$/))?(a=Math.min(a[1].length,6),this.startBlock("sh",b,a).endBlock(),!1):!0};h.prototype.parseBlockMh=function(a,b,c,d,e){return(c=c.match(/^\s*((=|-){2,})\s*$/))&&null!=a&&"normal"===a[0]&&!e[a[2]].match(/^\s*$/)?(this.isBlock("normal")?this.backBlock(1,"mh","="===c[1][0]?1:2).setBlock(b).endBlock():this.startBlock("normal",b),!1):!0};h.prototype.parseBlockHr=function(a,b,c){return c.match(/^[-\*]{3,}\s*$/)?(this.startBlock("hr",b).endBlock(),!1):!0};h.prototype.parseBlockDefault=
function(a,b,c,d){this.isBlock("footnote")?(c=c.match(/^(\s*)/),c[1].length>=a[3][0]?this.setBlock(b):this.startBlock("normal",b)):this.isBlock("table")?0<=c.indexOf("|")?(a[3][2]+=1,this.setBlock(b,a[3])):this.startBlock("normal",b):this.isBlock("quote")?c.match(/^(\s*)$/)?this.startBlock("normal",b):this.setBlock(b):null==a||"normal"!==a[0]?this.startBlock("normal",b):this.setBlock(b);return!0};h.prototype.optimizeBlocks=function(a,b){var c,d;a=a.slice(0);var e=b.slice(0);a=this.call("beforeOptimizeBlocks",
a,e);for(d=0;null!=a[d];){var f=!1;var g=a[d];var k=null!=a[d-1]?a[d-1]:null;var l=null!=a[d+1]?a[d+1]:null;var n=g[0];b=g[1];var r=g[2];"pre"===n&&(c=e.slice(g[1],g[2]+1).reduce(function(t,m){return m.match(/^\s*$/)&&t},!0))&&(g[0]=n="normal");"normal"===n&&(g=["list","quote"],b===r&&e[b].match(/^\s*$/)&&null!=k&&null!=l&&k[0]===l[0]&&0<=g.indexOf(k[0])&&(a[d-1]=[k[0],k[1],l[2],null],a.splice(d,2),f=!0));f||(d+=1)}return this.call("afterOptimizeBlocks",a,e)};h.prototype.parseCode=function(a,b,c){var d=
b[0];var e=b[1];e=v(e);var f=d.length;if(e.match(/^[_a-z0-9-\+#:\.]+$/i)){if(b=e.split(":"),1<b.length){e=b[0];var g=b[1];e=v(e);g=v(g)}}else e=null;var k=!0;a=a.slice(1,-1).map(function(l){l=l.replace(new RegExp("/^[ ]{"+f+"}/"),"");k&&!l.match(/^\s*$/)&&(k=!1);return u(l)});a=this.markLines(a,c+1).join("\n");return k?"":"<pre><code"+(e?' class="'+e+'"':"")+(g?' rel="'+g+'"':"")+">"+a+"</code></pre>"};h.prototype.parsePre=function(a,b,c){a=a.map(function(d){return u(d.substring(4))});a=this.markLines(a,
c).join("\n");return a.match(/^\s*$/)?"":"<pre><code>"+a+"</code></pre>"};h.prototype.parseAhtml=function(a,b,c){return v(this.markLines(a,c).join("\n"))};h.prototype.parseShtml=function(a,b,c){return v(this.markLines(a.slice(1,-1),c+1).join("\n"))};h.prototype.parseMath=function(a,b,c,d){return"<p>"+this.markLine(c,d)+u(a.join("\n"))+"</p>"};h.prototype.parseSh=function(a,b,c,d){a=this.markLine(c,d)+this.parseInline(v(a[0],"# "));return a.match(/^\s*$/)?"":"<h"+b+">"+a+"</h"+b+">"};h.prototype.parseMh=
function(a,b,c,d){return this.parseSh(a,b,c,d)};h.prototype.parseQuote=function(a,b,c){a=a.map(function(d){return d.replace(/^\s*> ?/,"")});a=a.join("\n");return a.match(/^\s*$/)?"":"<blockquote>"+this.parse(a,!0,c)+"</blockquote>"};h.prototype.parseList=function(a,b,c){var d,e,f,g;b="";var k=g=99999;var l=d=!1;var n=[];var r=e=0;for(f=a.length;e<f;r=++e){var t=a[r];if(r=t.match(/^(\s*)((?:[0-9]+\.?)|\-|\+|\*)(\s+)(.*)$/i)){var m=r[1].length;var w=0<="+-*".indexOf(r[2])?"ul":"ol";g=Math.min(m,g);
d=!0;0<m&&(k=Math.min(m,k),l=!0);n.push([m,w,t,r[4]])}else if(n.push(t),r=t.match(/^(\s*)/))m=r[1].length,0<m&&(k=Math.min(m,k),l=!0)}g=d?g:0;k=l?k:g;d="";e=[];r=a=f=0;for(l=n.length;a<l;r=++a){var p=n[r];p instanceof Array?(m=p[0],w=p[1],t=p[2],p=p[3],m!==g?e.push(t.replace(new RegExp("^\\s{"+k+"}"),"")):(0<e.length&&(b+="<li>"+this.parse(e.join("\n"),!0,c+f)+"</li>"),d!==w&&(d&&(b+="</"+d+">"),b+="<"+w+">"),f=r,e=[p],d=w)):e.push(p.replace(new RegExp("^\\s{"+k+"}"),""))}0<e.length&&(b+="<li>"+this.parse(e.join("\n"),
!0,c+f)+("</li></"+d+">"));return b};h.prototype.parseTable=function(a,b,c){var d,e,f;var g=b[0];b=b[1];var k=0<g.length&&0<g.reduce(function(A,G){return G+A});var l="<table>";var n=k?null:!0;var r=!1;var t=d=0;for(e=a.length;d<e;t=++d){var m=a[t];if(0<=g.indexOf(t))k&&r&&(k=!1,n=!0);else{m=v(m);r=!0;"|"===m[0]&&(m=m.substring(1),"|"===m[m.length-1]&&(m=m.substring(0,m.length-1)));var w=m.split("|").map(function(A){return A.match(/^\s*$/)?" ":v(A)});m={};var p=-1;var x=0;for(f=w.length;x<f;x++){var B=
w[x];0<B.length?(p+=1,m[p]=[null!=m[p]?m[p][0]+1:1,B]):null!=m[p]?m[p][0]+=1:m[0]=[1,B]}k?l+="<thead>":n&&(l+="<tbody>");l+="<tr";this.line&&(l+=' class="line" data-start="'+(c+t)+'" data-end="'+(c+t)+'" data-id="'+this.uniqid+'"');l+=">";for(t in m)p=m[t],x=p[0],f=p[1],p=k?"th":"td",l+="<"+p,1<x&&(l+=' colspan="'+x+'"'),null!=b[t]&&"none"!==b[t]&&(l+=' align="'+b[t]+'"'),l+=">"+this.parseInline(f)+("</"+p+">");l+="</tr>";k?l+="</thead>":n&&(n=!1)}}null!==n&&(l+="</tbody>");return l+="</table>"};
h.prototype.parseHr=function(a,b,c){return this.line?'<hr class="line" data-start="'+c+'" data-end="'+c+'">':"<hr>"};h.prototype.parseNormal=function(a,b,c){null==b&&(b=!1);var d=0;a=a.map(function(e){return function(f){f=e.parseInline(f);f.match(/^\s*$/)||(f=e.markLine(c+d)+f);d+=1;return f}}(this));a=v(a.join("\n"));a=a.replace(/(\n\s*){2,}/g,"</p><p>");a=a.replace(/\n/g,"<br>");return a.match(/^\s*$/)?"":b?a:"<p>"+a+"</p>"};h.prototype.parseFootnote=function(a,b){b=this.footnotes.indexOf(b[1]);
0<=b&&(a=a.slice(0),a[0]=a[0].replace(/^\[\^((?:[^\]]|\]|\[)+?)\]:/,""),this.footnotes[b]=a);return""};h.prototype.parseDefinition=function(){return""};h.prototype.parseHtml=function(a,b,c){a=a.map(function(d){return function(e){return d.parseInline(e,null!=d.specialWhiteList[b]?d.specialWhiteList[b]:"")}}(this));return this.markLines(a,c).join("\n")};h.prototype.cleanUrl=function(a){var b;(b=a.match(/^\s*((http|https|ftp|mailto):[x80-xff_a-z0-9-\.\/%#!@\?\+=~\|,&\(\)]+)/i))&&b[1];return(b=a.match(/^\s*([x80-xff_a-z0-9-\.\/%#!@\?\+=~\|,&]+)/i))?
b[1]:"#"};h.prototype.escapeBracket=function(a){return y(["\\[","\\]","\\(","\\)"],["[","]","(",")"],a)};h.prototype.startBlock=function(a,b,c){null==c&&(c=null);this.pos+=1;this.current=a;this.blocks.push([a,b,b,c]);return this};h.prototype.endBlock=function(){this.current="normal";return this};h.prototype.isBlock=function(a,b){null==b&&(b=null);return this.current===a&&(null===b?!0:this.blocks[this.pos][3]===b)};h.prototype.getBlock=function(){return null!=this.blocks[this.pos]?this.blocks[this.pos]:
null};h.prototype.setBlock=function(a,b){null==a&&(a=null);null==b&&(b=null);null!==a&&(this.blocks[this.pos][2]=a);null!==b&&(this.blocks[this.pos][3]=b);return this};h.prototype.backBlock=function(a,b,c){null==c&&(c=null);if(0>this.pos)return this.startBlock(b,0,c);var d=this.blocks[this.pos][2];this.blocks[this.pos][2]=d-a;a=[b,d-a+1,d,c];this.blocks[this.pos][1]<=this.blocks[this.pos][2]?(this.pos+=1,this.blocks.push(a)):this.blocks[this.pos]=a;this.current=b;return this};h.prototype.combineBlock=
function(){if(1>this.pos)return this;var a=this.blocks[this.pos-1].slice(0);var b=this.blocks[this.pos].slice(0);a[2]=b[2];this.blocks[this.pos-1]=a;this.current=a[0];this.blocks=this.blocks.slice(0,-1);--this.pos;return this};return h}();"undefined"!==typeof module&&null!==module?module.exports=E:"undefined"!==typeof window&&null!==window&&(window.HyperDown=E)}).call(this);
